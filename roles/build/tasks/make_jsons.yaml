# Saves components to <jsons> directory

# Arguments:
#   component_path: path to current version
#   built_components: built components

- block:
  - name: 'Create jsons directory: <v{{ b_version }}>'
    file:
      path: "{{ component_path }}/jsons"
      state: directory

  - file:
      path: "{{ component_path }}/jsons/components"
      state: directory
  - file:
      path: "{{ component_path }}/jsons/index_templates"
      state: directory

  - name: 'Move components enriched with settings to jsons'
    copy:
      dest: "{{ path }}"
      content: "{{ nested | to_json }}"

    vars:
      nested:
        template: "{{ item.value }}"
      path: "{{ component_path }}/jsons/components/{{ item.key }}.json"
    with_dict: "{{ built_components }}"
    
  - name: 'Copy ready jsons from components directory to jsons (components)'
    copy:
      src: '{{ item }}'
      dest: "{{ component_path }}/jsons/components"

    with_fileglob: "{{ component_path }}/components/*.json"

  - name: 'Copy ready jsons from index templates directory to jsons (it)'
    copy:
      src: '{{ item }}'
      dest: "{{ component_path }}/jsons/index_templates"

    with_fileglob: "{{ component_path }}/components/*.json"