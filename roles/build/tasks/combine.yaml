# Combines settings and components with filter

# Arguments:
#   components
#   settings
#   components_status
#
# Sets:
#   built_components: name=>component_content

- block:
    - name: 'Add information from settings'
      set_fact:
        built_components: "{{ built_components|default({}) | combine({item.key: {'settings': merged_settings}}) }}"
      vars:
        merged_settings: "{{ item.value.settings | map('extract', settings) | list | combine(recursive=True) }}"

      when: components_status[item.key] | default(False)
      with_dict: "{{ components }}"
    
    - name: 'Show components status'
      debug:
        msg: '{{ components_status }}'